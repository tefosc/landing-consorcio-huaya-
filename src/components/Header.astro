---
import { Sun, Moon, Menu, X } from "lucide-astro";
---

<header
  class="fixed top-0 w-full bg-white/80 dark:bg-gray-900/80 backdrop-blur-md z-50 border-b border-gray-200 dark:border-gray-700"
>
  <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
      <!-- Logo -->
      <a href="#inicio" class="flex items-center space-x-3 group">
        <div
          class="w-10 h-10 rounded-lg overflow-hidden transition-transform duration-300 group-hover:scale-105"
        >
          <img
            src="/images/header.jpg"
            alt="Logo Consorcio Ejecutor Huaya"
            class="w-full h-full object-cover"
          />
        </div>
        <div class="hidden sm:block">
          <h1 class="font-bold text-lg text-gray-900 dark:text-white">
            Consorcio
          </h1>
          <p class="text-sm text-gray-600 dark:text-gray-300">Ejecutor Huaya</p>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8">
        <a
          href="#inicio"
          class="nav-link relative py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors font-medium"
          data-section="inicio"
        >
          Inicio
        </a>
        <a
          href="#nosotros"
          class="nav-link relative py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors font-medium"
          data-section="nosotros"
        >
          Quienes somos
        </a>
        <a
          href="#servicios"
          class="nav-link relative py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors font-medium"
          data-section="servicios"
        >
          Servicios
        </a>
        <a
          href="#contacto"
          class="nav-link relative py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors font-medium"
          data-section="contacto"
        >
          Contacto
        </a>
      </div>

      <!-- Theme Toggle and Mobile Menu -->
      <div class="flex items-center space-x-4">
        <!-- Theme Toggle -->
        <button
          id="theme-toggle"
          class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors focus:outline-none"
          aria-label="Toggle theme"
        >
          <Sun class="w-5 h-5 hidden dark:block" />
          <Moon class="w-5 h-5 block dark:hidden" />
        </button>

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-button"
          class="md:hidden p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 focus:outline-none"
          aria-label="Toggle menu"
        >
          <Menu class="w-5 h-5 block menu-open" />
          <X class="w-5 h-5 hidden menu-close" />
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div
      id="mobile-menu"
      class="hidden md:hidden border-t border-gray-200 dark:border-gray-700"
    >
      <div class="py-4 space-y-2">
        <a
          href="#inicio"
          class="nav-link-mobile block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors font-medium"
          data-section="inicio"
        >
          Inicio
        </a>
        <a
          href="#nosotros"
          class="nav-link-mobile block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors font-medium"
          data-section="nosotros"
        >
          Nosotros
        </a>
        <a
          href="#servicios"
          class="nav-link-mobile block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors font-medium"
          data-section="servicios"
        >
          Servicios
        </a>
        <a
          href="#contacto"
          class="nav-link-mobile block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors font-medium"
          data-section="contacto"
        >
          Contacto
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  // Theme toggle
  const themeToggle = document.getElementById("theme-toggle");

  themeToggle?.addEventListener("click", () => {
    const currentTheme = document.documentElement.getAttribute("data-theme");
    const newTheme = currentTheme === "dark" ? "light" : "dark";

    document.documentElement.setAttribute("data-theme", newTheme);
    localStorage.setItem("theme", newTheme);
  });

  // Mobile menu toggle
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuOpen = document.querySelector(".menu-open");
  const menuClose = document.querySelector(".menu-close");

  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
    menuOpen?.classList.toggle("hidden");
    menuClose?.classList.toggle("hidden");
  });

  // Close mobile menu when clicking on links
  const mobileLinks = document.querySelectorAll("#mobile-menu a");
  mobileLinks.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu?.classList.add("hidden");
      menuOpen?.classList.remove("hidden");
      menuClose?.classList.add("hidden");
    });
  });

  // Active section indicator
  const sections = document.querySelectorAll("section[id]");
  const navLinks = document.querySelectorAll(".nav-link");
  const navLinksMobile = document.querySelectorAll(".nav-link-mobile");

  function updateActiveLink() {
    let currentSection = "";

    sections.forEach((section) => {
      if (section instanceof HTMLElement) {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;
        if (window.scrollY >= sectionTop - 100) {
          currentSection = section.getAttribute("id") || "";
        }
      }
    }); // Update desktop nav
    navLinks.forEach((link) => {
      link.classList.remove("active");
      if (link.getAttribute("data-section") === currentSection) {
        link.classList.add("active");
      }
    });

    // Update mobile nav
    navLinksMobile.forEach((link) => {
      link.classList.remove("active-mobile");
      if (link.getAttribute("data-section") === currentSection) {
        link.classList.add("active-mobile");
      }
    });
  }

  // Update on scroll
  window.addEventListener("scroll", updateActiveLink);
  // Update on load
  updateActiveLink();
</script>

<style>
  /* Active link styles for desktop */
  .nav-link.active {
    color: rgb(37, 99, 235);
  }

  :global([data-theme="dark"]) .nav-link.active {
    color: rgb(96, 165, 250);
  }

  .nav-link.active::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: rgb(37, 99, 235);
    border-radius: 2px;
  }

  :global([data-theme="dark"]) .nav-link.active::after {
    background: rgb(96, 165, 250);
  }

  /* Active link styles for mobile */
  .nav-link-mobile.active-mobile {
    background-color: rgb(239, 246, 255);
    color: rgb(37, 99, 235);
  }

  :global([data-theme="dark"]) .nav-link-mobile.active-mobile {
    background-color: rgb(30, 58, 138);
    color: rgb(96, 165, 250);
  }
</style>
